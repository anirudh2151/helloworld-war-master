{
	"AWSTemplateFormatVersion": "2010-09-09",
	"Description": "EC2 and RDS for cloudformation",
	"Parameters": {

		"DBPassword": {
			"NoEcho": "true",
			"Description": "The database admin account password",
			"Type": "String",
			"MinLength": "8",
			"MaxLength": "41",
			"AllowedPattern": "[a-zA-Z0-9]*"
		}
	},
	"Resources": {
		"RDSDBSecurityGroup": {
			"Type": "AWS::RDS::DBSecurityGroup",
			"Properties": {
				"EC2VpcId": "",
				"DBSecurityGroupIngress": [{
					"EC2SecurityGroupId": ""
				}],
				"GroupDescription": "sg for "
			}
		},
		"RDSInstance": {
			"Type": "AWS::RDS::DBInstance",
			"Properties": {
				"DBSecurityGroups": [{
					"Ref": "RDSDBSecurityGroup"
				}],
				"EngineVersion": "12.1.0.2.v8",
				"AvailabilityZone": "us-west-2c",
				"MultiAZ": false,
				"LicenseModel": "license-included",
				"DBInstanceClass": "db.t2.small",
				"CopyTagsToSnapshot": false,
				"StorageEncrypted": false,
				"CharacterSetName": "AL32UTF8",
				"BackupRetentionPeriod": 0,
				"PreferredMaintenanceWindow": "thu:08:29-thu:08:59",
				"AllocatedStorage": 250,
				"MasterUsername": "",
				"MasterUserPassword": {
					"Ref": "DBPassword"
				},
				"AutoMinorVersionUpgrade": true,
				"StorageType": "gp2",
				"Engine": "oracle-se2",
				"PubliclyAccessible": true,
				"DBSnapshotIdentifier": "",
				"DBName": "",
				"MonitoringInterval": 0,
				"PreferredBackupWindow": "09:45-10:15"
			}
		},
		"Ec2Instance": {
			"Type": "AWS::EC2::Instance",
			"Properties": {
				"AvailabilityZone": "us-west-2c",
				"EbsOptimized": false,
				"ImageId": "",
				"InstanceType": "t2.small",
				"KeyName": "",
				"Monitoring": true,
				"SecurityGroupIds": [""],
				"SecurityGroups": [""],
				"SourceDestCheck": true,
				"Tenancy": "default",
				"Tags": [{
					"Key": "RDSAddress",
					"Value": {
						"Fn::GetAtt": ["RDSInstance", "Endpoint.Address"]
					}
				}, {
					"Key": "RDSPort",
					"Value": {
						"Fn::GetAtt": ["RDSInstance", "Endpoint.Port"]
					}
				}],
				"UserData": {
					"Fn::Base64": {
						"Fn::Join": ["", [
							"#!/bin/bash -xe\n",
							"# Install the files and packages from the metadata\n",
							"/opt/aws/bin/cfn-init -v ",
							"         --stack ", {
								"Ref": "AWS::StackName"
							},
							"         --resource Ec2Instance ",
							"         --configsets InstallAndRun ",
							"         --region ", {
								"Ref": "AWS::Region"
							}, "\n",
							"sudo su", "\n",
							"curl https://s3-us-west-2.amazonaws.com/cf-templates-us-west-2/.sh --output /home/.sh", "\n",
							"dos2unix /home/.sh", "\n",
							"chmod +x /home/.sh", "\n",
							"/home/.sh ", {
								"Fn::GetAtt": ["RDSInstance", "Endpoint.Address"]
							}, "\n"
						]]
					}
				}
			},
			"DependsOn": "RDSInstance",
			"Metadata": {
				"AWS::CloudFormation::Init": {
					"configSets": {
						"InstallAndRun": ["Install"]
					},
					"Install": {
						"files": {
							"/home/rds.txt": {
								"content": {
									"Fn::Join": ["", [{
										"Fn::GetAtt": ["RDSInstance", "Endpoint.Address"]
									}]]
								},
								"mode": "000600",
								"owner": "root",
								"group": "root"
							}
						}
					}
				}
			}
		}
	}
}
